---
- hosts: all
  tasks:

  - name: Register system to satellite and repos
    include_role:
      name: register-system
    tags:
      - register


  - name: Install postgresql 95
    yum:
      name:
        - rh-postgresql95
        - rh-postgresql95-postgresql-contrib
      state: latest
    tags:
      - install-postgres

  - name: Install Docker
    yum:
      name: docker 
      state: latest
    tags:
      - install-docker

  - name: Start and enable docker 
    systemd:
      name: docker 
      state: started
      enabled: yes
    tags:
      - start-docker

  - name: Enable firewalld ports for postgresql 
    firewalld:
      port: "{{ item }}"
      permanent: yes
      state: enabled
      zone: public
    with_items:
      - 8443/tcp
      - 80/tcp
      - 443/tcp
    notify:
      - reload-firewall
    tags:
      - firewalld

  handlers:

  - name: reload-firewall
    command: firewall-cmd --reload